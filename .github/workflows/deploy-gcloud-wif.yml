# 1. ตั้งค่า gcloud CLI และ Project ID (ต้องมีขั้นตอนนี้ก่อน)
      - name: Set up Cloud SDK
        uses: 'google-github-actions/setup-gcloud@v2'
        with:
          project_id: ${{ secrets.GCP_PROJECT_ID }}

      # 2. Build และ Push Docker Image ไปยัง Artifact Registry
      - name: Build and Push Docker Image
        # 💡 ใช้ Action ที่รวม Build และ Push เข้าด้วยกัน
        # ชื่อ Action ที่ถูกต้องคือ 'build-and-push-docker' 
        uses: 'google-github-actions/build-and-push-docker@v2' 
        with:
          # สร้าง Image Path ในรูปแบบ REGION-docker.pkg.dev/PROJECT_ID/...
          image: '${{ secrets.GCP_REGION }}-docker.pkg.dev/${{ secrets.GCP_PROJECT_ID }}/cloud-run-source-deploy/${{ secrets.SERVICE_NAME }}'
          tag: 'sha-${{ github.sha }}'
          dockerfile: ${{ secrets.PATH_TO_DOCKERFILE }} 
          
      # 3. Deploy ไปยัง Cloud Run
      - name: Deploy to Cloud Run
        uses: 'google-github-actions/deploy-cloudrun@v2'
        with:
          service: ${{ secrets.SERVICE_NAME }}
          region: ${{ secrets.GCP_REGION }}
          # ใช้ Image URL ที่เพิ่ง Build และ Push ไป (จาก Step 2)
          image: '${{ secrets.GCP_REGION }}-docker.pkg.dev/${{ secrets.GCP_PROJECT_ID }}/cloud-run-source-deploy/${{ secrets.SERVICE_NAME }}:sha-${{ github.sha }}'
          # (ทางเลือก) ถ้าต้องการให้เปิดการเข้าถึงแบบไม่ยืนยันตัวตน
          # allow-unauthenticated: true